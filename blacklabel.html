<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="blacklabel.css">
</head>

<div class="sheet-container">
    <div class="main-content">

        <!--MECHANICS SECTION: DONE -->

        <div class="sheet-section-mechanics sheet-section sheet-quarter">

                <div class="sheet-row" style="padding-left: 5px;">

                    <div class="mechanics-container">

                        <img src="https://raw.github.com/milostuff/black-label-sheet/main/hp.png" alt="hp" style="width:150px; height: 150px;">

                        <input type="number" name="attr_hp" value="0"/>

                        <div class="circle">
                            <input type="number" name="attr_hp" value="10"/>
                        </div>

                    <div class="mechanics-container">

                        <img src="https://raw.github.com/milostuff/black-label-sheet/main/shield.png" alt="shield" style="width:150px; height: 150px">

                        <input type="number" name="attr_shield" value="0" style="left: 59px"/>

                        <div class="circle">
                            <input type="number" name="attr_shield" value="0"/>
                        </div>

                    </div>

                    <div class="mechanics-container" >

                        <img src="https://raw.github.com/milostuff/black-label-sheet/main/bp.png" alt="bp" style="width:150px; height: 150px;">

                        <input type="number" name="attr_bp" value="0"/>

                        <div class="circle">
                            <input type="number" name="attr_bp" value="5"/>
                        </div>
                    </div>
                
                </div>

            </div>

        </div>

        <!--ID SECTION: DONE -->
        <div class="sheet-section-id sheet-section sheet-threequarters">
                
                <div class="sheet-header">
                    <span>ID</span>
                </div>

                <input class="sheet-level-flag sheet-hidden" type="checkbox" name="attr_show_level_flag" value="1" checked />
                <div class="sheet-section sheet-section-id-info">
                    <div class="sheet-repitem">
                        <input type="text" name="attr_id_name" placeholder="Name" />
                    </div>

                    <div class="sheet-row">
                        <input type="text" name="attr_id_past" placeholder="Past" style="width:45%"/>
                        <input type="text" name="attr_id_discipline" placeholder="Discipline" style="width:50%"/>
                    </div>
                    
                    <div class="sheet-repitem">
                        <textarea name="attr_id_description" placeholder="Description"></textarea>
                    </div>
                </div>

                <div class="sheet-section sheet-section-id-level">
                    <div class="sheet-repitem">
                        <span>Level</span>
                        <input type="number" name="attr_id_level" placeholder="0" />
                    </div>

                    <div class="sheet-repitem" style="padding-top: 10px;">
                        <span>Proficiency</span>
                        <input type="number" name="attr_proficiency" placeholder="0" />
                    </div>
                </div>
        </div>

        <!--SKILLS SECTION: DONE-->
            
        <div class="sheet-section-skills sheet-section sheet-half">

                <div class="section-skills sheet-row">
                        
                    <div class="sheet-col">

                        <div class="stat-header">
                        <span>Body (<input type="number" name="attr_stat_body" value="0"/>)</span>
                        </div>

                        <div class="container-skill">
                            
                        <span>Strength</span>
                        <input type="number" name="attr_skill_str" value="0" />
                        <span>Will</span>
                        <input type="number" name="attr_skill_wil" value="0" />
                        <span>Vigor</span>
                        <input type="number" name="attr_skill_vig" value="0" />

                        </div>

                    </div>

                    <div class="sheet-col">

                        <div class="stat-header">
                            <span>Technique (<input type="number" name="attr_stat_tech" value="0"/>)</span>
                        </div>

                        <div class="container-skill">
                            <span>Acrobratics</span>
                            <input type="number" name="attr_skill_acr" value="0" />
                            <span>Finesse</span>
                            <input type="number" name="attr_skill_fin" value="0" />
                            <span>Control</span>
                            <input type="number" name="attr_skill_cont" value="0" />
                        </div>

                    </div>

                </div>


                <div class="sheet-row">

                    <div class="sheet-col">

                        <div class="stat-header">
                            <span>Presence (<input type="number" name="attr_stat_pres" value="0" />)</span>
                        </div>

                        <div class="container-skill">
                            
                            <span>Rapport</span>
                            <input type="number" name="attr_skill_rap" value="0" />
                            <span>Menace</span>
                            <input type="number" name="attr_skill_men" value="0" />
                            <span>Convince</span>
                            <input type="number" name="attr_skill_con" value="0" />
                        </div>

                    </div>

                    <div class="sheet-col">

                        <div class="stat-header">
                            <span>Mind (<input type="number" name="attr_stat_mind" value="0"/>)</span>
                        </div>
                        
                        <div class="container-skill">

                            <span>Empathy</span>
                            <input type="number" name="attr_skill_emp" value="0" />
                            <span>Lore</span>
                            <input type="number" name="attr_skill_lore" value="0" />
                            <span>Insight</span>
                            <input type="number" name="attr_skill_ins" value="0" />
                        </div>
                    </div>

                </div>

        </div>

        <!--ROLLS SECTION: DONE-->

        <div class="sheet-section-rolls sheet-section sheet-quarter">

            <div class="sheet-col" style="padding: 20px; padding-right: 20px">

                <div class="d12">
                    <button type="roll" name="roll_daggerheart_d12" value="&{template:default} {{name=
        [[[ $[[13]][Boon] + $[[52]][Dread] ?{Advantage|Regular, |Advantage,+ 1d6|Disadvantage,- 1d6} +(?{Modifier?|0}) ]]]
        $[[$[[66]]]] [[[[[ [[ {0,$[[25]]}=$[[65]]*79 ]] 
        $[[$[[0]]]]  [[1d12 Boon]] [[ [[ [[ [[ [[ [[ [[ [[ [[ [[ [[ [[ 0 ]] ]] ]] ]] ]] ]] ]] ]] ]] ]] ]] ]]
        [[12]][[11]][[10]][[9]][[8]][[7]][[6]][[5]][[4]][[3]][[2]][[1]]
        [[12]][[11]][[10]][[9]][[8]][[7]][[6]][[5]][[4]][[3]][[2]][[1]]
        $[[37]] [[ [[ [[ [[ [[ [[ [[ [[ [[ [[ [[ [[ 0 ]] ]] ]] ]] ]] ]] ]] ]] ]] ]] ]] ]]
        $[[$[[39]]]] [[ [[1d12 Dread]]+39 ]] [[ [[ [[ [[ [[ [[ [[ [[ [[ [[ [[ [[ 0 ]] ]] ]] ]] ]] ]] ]] ]] ]] ]] ]] ]]
        [[12]][[11]][[10]][[9]][[8]][[7]][[6]][[5]][[4]][[3]][[2]][[1]]
        [[12]][[11]][[10]][[9]][[8]][[7]][[6]][[5]][[4]][[3]][[2]][[1]]
        $[[78]] [[ [[ [[ [[ [[ [[ [[ [[ [[ [[ [[ [[ 0 ]] ]] ]] ]] ]] ]] ]] ]] ]] ]] ]] ]]
        ]]]]]
        }} {{name=Duality}} {{Boon=$[[0.computed]]}} {{Dread=$[[38.computed]]}} [[[ [[0]] {{Critical!}} ]]] {{Total=$[[53.computed]]}}">

                    <img src="https://raw.github.com/milostuff/black-label-sheet/main/D12.png"> 
                
                    </button>
                </div>
                
                <div class="weapon-damage">

                    <div class="primary-weapon">
                        <button type="roll" name="roll_primary_weapon_damage" value="&{template:default} {{name=@{primary_weapon_name} Damage}} {{Damage=[[@{proficiency} + @{primary_weapon_die_qty}@{primary_weapon_damage_die} + @{primary_weapon_damage_bonus}]]}} {{Type=@{primary_weapon_type}}}">
                            
                            Primary Weapon Damage

                        </button>
                    </div>

                    <div class="secondary-weapon">
                        <button type="roll" name="roll_secondary_weapon_damage" value="&{template:default} {{name=@{secondary_weapon_name} Damage}} {{Damage=[[@{proficiency} + @{secondary_weapon_die_qty}@{secondary_weapon_damage_die} + @{secondary_weapon_damage_bonus}]]}} {{Type=@{secondary_weapon_type}}}">
                            
                            Secondary Weapon Damage
                        
                        </button>
                    </div>

                </div>

            </div>

        </div>

        <div class="sheet-break"></div>

        <!--BONUSES SECTION: DONE-->
        <div class="sheet-section-bonuses sheet-section sheet-half">
            <div class="sheet-header">
                <span>Bonuses and Stunts</span>
            </div>
            <fieldset class="repeating_bonuses">
                <div class="sheet-item-options">
                    <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
                    <div class="sheet-display">
                        <input class="sheet-item-options-flag2" type="checkbox" name="attr_more_flag" checked="checked" />
                        <span>E</span>
                    </div>
                    <input class="sheet-item-options-flag" type="checkbox" name="attr_options_flag" checked="checked" />
                    <span>p</span>
                </div>
                <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
                <div class="sheet-options">
                    <input type="text" name="attr_bonus_name" placeholder="Name" />
                    <textarea name="attr_bonus_desc" placeholder="Description"></textarea>
                </div>
                <div class="sheet-display">
                    <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_more_flag" checked="checked" />
                    <div class="sheet-display">
                        <h3 class="sheet-right-buttons">
                            <button type="roll" class="sheet-action-button" name="roll_bonuses" value="&{template:bonuses} {{bonuses=@{bonus_name}}} {{description=@{bonus_desc}}}">
                                <span name="attr_bonus_name"></span>
                            </button>
                        </h3>
                        
                        <span name="attr_bonus_desc" class="sheet-keep-whitespace" style="text-wrap: wrap;"> </span>
                    </div>
                    <div class="sheet-options">
                        <h3 class="sheet-right-buttons">
                            <button type="roll" class="sheet-action-button sheet-tooltip" name="roll_bonuses" value="&{template:bonuses} {{bonuses=@{bonus_name}}} {{description=@{bonus_desc}}}">
                                <span name="attr_bonus_name"></span>
                                <span name="attr_bonus_desc" class="sheet-tooltipText sheet-keep-whitespace"></span>
                            </button>
                        </h3>
                    </div>
                </div>
            </fieldset>
        </div>

        <!--KEYWORDS SECTION: 1. Wrap description text-->
        <div class="sheet-section-keywords sheet-section sheet-half">
            <div class="sheet-header">
                <span>Keywords</span>
            </div>
            <fieldset class="repeating_keywords">
                <div class="sheet-item-options">
                    <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
                    <div class="sheet-display">
                        <input class="sheet-item-options-flag2" type="checkbox" name="attr_more_flag" checked="checked" />
                        <span>E</span>
                    </div>
                    <input class="sheet-item-options-flag" type="checkbox" name="attr_options_flag" checked="checked" />
                    <span>p</span>
                </div>
                <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
                <div class="sheet-options">
                    <input type="text" name="attr_key_name" placeholder="Name" />
                    <input type="text" name="attr_key_source" placeholder="Source" />
                    <textarea name="attr_key_desc" placeholder="Description"></textarea>
                </div>
                <div class="sheet-display">
                    <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_more_flag" checked="checked" />
                    <div class="sheet-display">
                        <h3 class="sheet-right-buttons">
                            <button type="roll" class="sheet-action-button" name="roll_keywords" value="&{template:keywords} {{name=@{key_name}}} {{source=@{key_source}}} {{description=@{key_desc}}}">
                                <span name="attr_key_name"></span>
                            </button>
                        </h3>

                        <div class="sheet-row">
                            <span class="sheet-inlineLabel">Source</span>
                            <span class="sheet-inlineLabel">: </span>
                            <span name="attr_key_source"></span>
                        </div>
        
                        <span name="attr_key_desc" class="sheet-keep-whitespace" style="text-wrap: wrap;"></span>
                    </div>
                    <div class="sheet-options">
                        <h3 class="sheet-right-buttons">
                            <button type="roll" class="sheet-action-button sheet-tooltip" name="roll_keywords" value="&{template:keywords} {{name=@{key_name}}} {{source=@{key_source}}} {{description=@{key_desc}}}">
                                <span name="attr_key_name"></span>
                                <span name="attr_key_source"></span>
                                <span name="attr_key_desc" class="sheet-tooltipText sheet-keep-whitespace"></span>
                            </button>
                        </h3>
                    </div>
                </div>
            </fieldset>
        </div>

        <div class="sheet-break"></div>


        <!--INVENTORY SECTION:-->

        <div class="sheet-section-inventory sheet-section sheet-quarter">
            <div class="sheet-header">
                <span>Inventory</span>
            </div>

            <div class="container-currency">
                <input type="number" name="attr_dollars_qty" placeholder="0"/>
                <input type="text" name="attr_currency_dollar" placeholder="USD" readonly/>

                <input type="number" name="attr_unknown1_qty" placeholder="0"/>
                <input type="text" name="attr_currency_unknown1" placeholder="???" readonly/>

                <input type="number" name="attr_unknown2_qty" placeholder="0"/>
                <input type="text" name="attr_currency_unknown2" placeholder="???" readonly/>

                <input type="number" name="attr_unknown3_qty" placeholder="0"/>
                <input type="text" name="attr_currency_unknown3" placeholder="???" readonly/>
                
            </div>

            <fieldset class="repeating_inventory">
                <input type="number" name="attr_invent_qty" placeholder="Qty"/>
                <input type="text" name="attr_invent_name" placeholder="Name"/>
            </fieldset>
        </div>

        <!--CONDITIONS SECTION: DONE
            1. Don't change the naming convention you dont want to deal with the edits
        -->
        <input class="sheet-conditions-flag sheet-hidden" type="checkbox" name="attr_show_conditions_flag" value="1" />

        <div class="sheet-section-consequences sheet-section sheet-half">
            <div class="sheet-header">
                <span>Conditions</span>
            </div>
            <div class="sheet-repitem sheet-consequence-row">
                <span class="sheet-consequence-worth"></span>
            </div>
            <fieldset class="repeating_consequences">
                <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
                <div class="sheet-options">
                    <select name="attr_worth">
                        <option value=2 selected><span>Mild</span> (2)</option>
                        <option value=4><span>Moderate</span> (4)</option>
                        <option value=6><span>Severe</span> (6)</option>
                        <option value=8><span>Extreme</span> (8)</option>
                    </select>
                    <input type="hidden" name="attr_worth_text" value="Mild"/>
                    <input type="checkbox" name="attr_isUsed" class="sheet-hidden" value="1" />
                    <div class="sheet-item-options sheet-consequence-edit">
                        <input class="sheet-item-options-flag" type="checkbox" name="attr_options_flag" checked="checked" />
                        <span>3</span>
                    </div>
                </div>
                <div class="sheet-display sheet-consequence-row">
                    <div class="sheet-consequence-worth">
                            <span class="sheet-worth-value" name="attr_worth"></span>
                            <span class="sheet-worth-text" name="attr_worth_text"></span>
                    </div>
                    <input type="text" name="attr_aspect" class="sheet-consequence-aspect" />
                </div>
            </fieldset>
        </div>

        <!--STATUS SECTION: DONE-->

        <div class="sheet-section-status sheet-section sheet-quarter">

            <div class="sheet-status">

                <div class="sheet-stress sheet-col">

                    <div class="sheet-status-header">
                    <span class="sheet-status-header-name" name="attr_status_stress">Stress</span>
                    </div>

                    <div class="sheet-status-row">
                    <input type="hidden" name="attr_stress_usable" />
                    <input type="checkbox" name="attr_stress_isUsed1" title="1" value=1 />
                    <input type="checkbox" name="attr_stress_isUsed2" title="2" value=2 />
                    <input type="checkbox" name="attr_stress_isUsed3" title="3" value=3 />
                    <input type="checkbox" name="attr_stress_isUsed4" title="4" value=4 />
                    </div>

                </div>

                <div class="sheet-sanity sheet-col">

                    <div class="sheet-status-header">
                    <span class="sheet-status-header-name" name="attr_status_sanity">Sanity</span>
                    </div>

                    <div class="sheet-status-row">
                        <input type="hidden" name="attr_sanity_usable" />
                        <input type="checkbox" name="attr_sanity_isUsed1" title="1" value=1 />
                        <input type="checkbox" name="attr_sanity_isUsed2" title="2" value=2 />
                        <input type="checkbox" name="attr_sanity_isUsed3" title="3" value=3 />
                        <input type="checkbox" name="attr_sanity_isUsed4" title="4" value=4 />
                    </div>
                    
                </div>

                <div class="sheet-enlightenment sheet-col">

                    <div class="sheet-status-header" style="font-size: medium; ">
                    <span class="sheet-status-header-name" name="attr_status_sanity">Enlightenment</span>
                    </div>

                    <input type="number" name="attr_enlightenment" placeholder="0" style="text-align: center;">
                     
                </div>

            </div>
                
        </div>

        <!--WEAPONS SECTION: DONE-->

        <div class="sheet-section-weapons sheet-section sheet-threequarters">

            <div class="section-weapon">

                <h3>Primary Weapon</h3>

                <div class="section_primary_weapon sheet-row" style="gap: 5px">

                    <input type="text" name="attr_primary_weapon_name" placeholder="Name" />
                    <input type="text" name="attr_primary_weapon_trait" placeholder="Trait" />
                    <input type="text" name="attr_primary_weapon_range" placeholder="Range" />
                    <input type="text" name="attr_primary_weapon_type" placeholder="Type" />

                    <input type="number" name="attr_primary_die_qty" placeholder="Qty" style="width: 10%; text-align: center;"/>

                    <select name="attr_primary_weapon_damage_die">
                        <option value="" disabled selected hidden>Damage</option>
                        <option value="d4">d4</option>
                        <option value="d6">d6</option>
                        <option value="d8">d8</option>
                        <option value="d10">d10</option>
                        <option value="d12">d12</option>
                        <option value="d20">d20</option>
                    </select>


                    <span class="sheet-plus-sign">+</span>
                    
                    <select name="attr_primary_weapon_damage_bonus">
                        <option value="" disabled selected hidden>Bonus</option>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                    </select>

                    <textarea name="attr_primary_weapon_feature" placeholder="Feature"></textarea>
                
                </div>

            </div>

            <div class="section-weapon">

                <h3>Secondary Weapon</h3>

                <div class="section_secondary_weapon sheet-row" style="gap: 5px">

                    <input type="text" name="attr_secondary_weapon_name" placeholder="Name" />
                    <input type="text" name="attr_secondary_weapon_trait" placeholder="Trait" />
                    <input type="text" name="attr_secondary_weapon_range" placeholder="Range" />
                    <input type="text" name="attr_secondary_weapon_type" placeholder="Type" />

                    <input type="number" name="attr_secondary_die_qty" placeholder="Qty" style="width: 10%; text-align: center;"/>

                    <select name="attr_primary_weapon_damage_die">
                        <option value="" disabled selected hidden>Damage</option>
                        <option value="d4">d4</option>
                        <option value="d6">d6</option>
                        <option value="d8">d8</option>
                        <option value="d10">d10</option>
                        <option value="d12">d12</option>
                        <option value="d20">d20</option>
                    </select>


                    <span class="sheet-plus-sign">+</span>
                    
                    <select name="attr_secondary_weapon_damage_bonus">
                        <option value="" disabled selected hidden>Bonus</option>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                    </select>

                    <textarea name="attr_secondary_weapon_feature" placeholder="Feature"></textarea>

                </div>

            </div>

        </div>

        <div class="sheet-break"></div>

        <!--NOTES SECTION: DONE-->

        <input class="sheet-weapons-flag sheet-hidden" type="checkbox" name="attr_show_weapons_flag" value="1" />

        <div class="sheet-section-notes sheet-section">
            <div class="sheet-header">
                <span>NOTES</span>
            </div>

            <fieldset class="repeating_notes">
                <input class="sheet-options-flag sheet-hidden" type="checkbox" name="attr_options_flag" checked="checked" />
                <div class="sheet-item-options sheet-notes-edit">
                    <input class="sheet-item-options-flag" type="checkbox" name="attr_options_flag" checked="checked" />
                    <span>p</span>
                </div>
                <div class="sheet-options sheet-notes-row">
                    <input type="text" name="attr_title" placeholder="Notes Title" />
                    <textarea name="attr_body" placeholder="Notes"></textarea>
                </div>
                <div class="sheet-display sheet-notes-row">
                    <h3><span name="attr_title"></span></h3>
                    <span name="attr_body" class="sheet-keep-whitespace"></span>
                </div>
            </fieldset>

        </div>

        <div class="sheet-break"></div>

    </div>
</div>

<!--BONUS ROLL SECTION: DONE-->

<rolltemplate class="sheet-rolltemplate-bonuses">
    <div class="sheet-rollTemplate">
        <div class="row sheet-header">
            <span>Bonuses and Stunts</span>
            <span>: </span>
            <span>{{bonuses}}</span>
        </div>
        <div class="row">
            <span>{{description}}</span>
        </div>
    </div>
</rolltemplate>


<!--KEYWORD ROLL SECTION: DONE-->

<rolltemplate class="sheet-rolltemplate-keywords">
    <div class="sheet-rollTemplate">
        <div class="row sheet-header">
            <span>Keyword</span>
            <span>: </span>
            <span>{{keyword}}</span>
        </div>
        <div class="row">
            <span class="sheet-inlineLabel">Source</span>
            <span class="sheet-inlineLabel">: </span>
            <span>{{source}}</span>
        </div>
        <div class="row">
            <span>{{description}}</span>
        </div>
    </div>
</rolltemplate>

<!--WEAPONS ROLL SECTION
    1. Show weapon roll and damage when pressed
    2. Damage and Bonus does not show up auhhuhuh
    3. Have an option to set weapon to active/inactive and primary/secondary
-->

<rolltemplate class="sheet-rolltemplate-weapons">
    <div class="sheet-rollTemplate">
        <div class="row sheet-header">
            <span>Weapon</span>
            <span>: </span>
            <span>{{name}}</span>
        </div>
        <div class="row">
            <span class="sheet-inlineLabel">Trait</span>
            <span class="sheet-inlineLabel">: </span>
            <span>{{trait}}</span>
        </div>
        <div class="row">
            <span class="sheet-inlineLabel">Range</span>
            <span class="sheet-inlineLabel">: </span>
            <span>{{range}}</span>
        </div>
        <div class="row">
            <span class="sheet-inlineLabel">Type</span>
            <span class="sheet-inlineLabel">: </span>
            <span>{{type}}</span>
        </div>
        <div class="row">
            <span class="sheet-inlineLabel">Damage</span>
            <span class="sheet-inlineLabel">: </span>
            <span>{{damage}} + {{bonus}}</span>
        </div>
        <div class="row">
            <span>{{description}}</span>
        </div>
    </div>
</rolltemplate>

    
<script type="text/worker">
    on('sheet:opened', function () {
        getAttrs(["run_firstTime_setup", "default_stressSkills",
                    "default_consequences", "show_conditions_flag",
                    "importedOldData_flag"], function (values) {
            if (isNullOrWhitespace(values["importedOldData_flag"]))
            {
                ImportIdData();
                ImportSkills();
                ImportAspects();
                ImportStunts();
                ImportExtras();
                ImportStresses(values["run_firstTime_setup"], values["default_stressSkills"]);
                ImportConsequences(values["run_firstTime_setup"],
                    values["default_consequences"],
                    values["show_conditions_flag"]);
                ImportNotes();
    
                setAttrs({ importedOldData_flag: 1, run_firstTime_setup: 0 });
                return;
            }
            if (!isNullOrWhitespace(values["run_firstTime_setup"])) {
                SetDefaultStress(values["default_stressSkills"]);
                SetDefaultConsequences(values["default_consequences"], values["show_conditions_flag"]);
    
                setAttrs({ run_firstTime_setup: 0 });
            }
        });
    });
    
    function ImportStresses (runFirstTimeSetup, default_stressSkills) {
        var attr = [];
        attr.push("PhyGoverningSkill");
        attr.push("MenGoverningSkill");
        for (var i = 1; i < 5; i++) {
            attr.push("Phy" + i);
            attr.push("Phy" + i + "Active");
            attr.push("Men" + i);
            attr.push("Men" + i + "Active");
        }
        
        getAttrs(attr, function (basicValues) {
            var phyGoverningSkill = basicValues["PhyGoverningSkill"];
            if (isNullOrWhitespace(phyGoverningSkill))
                phyGoverningSkill = "Physique";
            
            var menGoverningSkill = basicValues["MenGoverningSkill"];
            if (isNullOrWhitespace(menGoverningSkill))
                menGoverningSkill = "Will";
            
            getSectionIDs("repeating_Stress", function (idArray) {
                if (idArray.length == 0) {
                    importStress("Physical", phyGoverningSkill, "Phy", basicValues);
                    importStress("Mental", menGoverningSkill, "Men", basicValues);
                        
                    if (!isNullOrWhitespace(runFirstTimeSetup))
                        SetDefaultStress(default_stressSkills);
    
                    return;
                }
            
                var attrs = [];
                idArray.forEach(id =>  {
                    attrs.push("repeating_Stress_" + id + "_Name");
                    attrs.push("repeating_Stress_" + id + "_Mirrored");
                    for (var x = 1; x < 5; x++) {
                        attr.push("repeating_Stress_" + id + "_Stress" + x);
                        attr.push("repeating_Stress_" + id + "_Stress" + x + "Active");
                    }
                });
    
                getAttrs(attrs, function (repValues) {
                    var mirrors = [];
                    for (var i = 0; i < idArray.length; i++) {
                        mirrors.push("repeating_StressOptions_" + repValues["repeating_Stress_" + idArray[i] + "_Mirrored"] + "_GoverningSkill");
                    }
        
                    getAttrs(mirrors, function (mirroredValues) {
                        importStress("Physical", phyGoverningSkill, "Phy", basicValues);
                        importStress("Mental", menGoverningSkill, "Men", basicValues);
    
                        idArray.forEach(id => {
                            importStress(repValues["repeating_Stress_" + id + "_Name"],
                                mirroredValues["repeating_StressOptions_" + repValues["repeating_Stress_" + id + "_Mirrored"] + "_GoverningSkill"],
                                "repeating_Stress_" + id + "_Stress", repValues);
                            
                            removeRepeatingRow("repeating_StressOptions_" + repValues["repeating_Stress_" + id + "_Mirrored"]);
                            removeRepeatingRow("repeating_Stress_" + id);
                        });
                        
                        if (!isNullOrWhitespace(runFirstTimeSetup))
                            SetDefaultStress(default_stressSkills);
                    });
                });
            });    
        });
    };
    
    const importStress = (stress, skill, prefix, attrs) => {
        var newRowAttrs = {};
        var stressMax = 0;
    
        var newRowId = generateRowID();
        newRowAttrs["repeating_stress_" + newRowId + "_name"] = stress.trim();
    
        for (var i = 1; i < 5; i++) {
            if(!isNullOrWhitespace(attrs[prefix + i + "Active"])) {
                stressMax++;
                if(!isNullOrWhitespace(attrs[prefix + i]))
                    newRowAttrs["repeating_stress_" + newRowId + "_isUsed" + i] = i;
            }
            else
                return;
        }
    
        if (stressMax == 0)
            return;
    
        newRowAttrs["repeating_stress_" + newRowId + "_usable"] = stressMax;
    
        if (!isNullOrWhitespace(skill)) {
            newRowAttrs["repeating_stress_" + newRowId + "_skill"] = skill.trim();
            newRowAttrs["repeating_stress_" + newRowId + "_bound"] = 1;
        }
    
        setAttrs(newRowAttrs);
    };
    
    function SetDefaultStress (default_stressSkills) {
        if (!isNullOrWhitespace(default_stressSkills)) {
            getSectionIDs("repeating_stress", function (idArray) {
                if (idArray.length == 0) {
                    var stressSkills = default_stressSkills.split(",");
                    var newRowAttrs = {};
                    stressSkills.forEach(element => {
                        var keyValuePair = element.split(":");
                        var newRowId = generateRowID();
                        newRowAttrs["repeating_stress_" + newRowId + "_name"] = keyValuePair[0].trim();
                        if (keyValuePair.length > 1) {
                            var skill = keyValuePair[1].trim();
                            var usable = Number(skill);
                            if (isNaN(usable)) {
                                newRowAttrs["repeating_stress_" + newRowId + "_skill"] = skill;
                                newRowAttrs["repeating_stress_" + newRowId + "_usable"] = 2;
                                newRowAttrs["repeating_stress_" + newRowId + "_bound"] = 1;
                            }
                            else {
                                newRowAttrs["repeating_stress_" + newRowId + "_usable"] = usable;
                                newRowAttrs["repeating_stress_" + newRowId + "_bound"] = 0;
                            }
                            newRowAttrs["repeating_stress_" + newRowId + "_options_flag"] = 0;
                        }
                        else {
                            newRowAttrs["repeating_stress_" + newRowId + "_options_flag"] = "on";
                        }
                    });
                    setAttrs(newRowAttrs);
                }
            });
        }
    };
    
    function ImportConsequences (runFirstTimeSetup, default_consequences, show_conditions_flag) {
        var attr = [];
        attr.push("MildConsequence");
        attr.push("MildInvoke");
        attr.push("ModerateConsequence");
        attr.push("ModerateInvoke");
        attr.push("SevereConsequence");
        attr.push("SevereInvoke");
        
        getAttrs(attr, function (basicValues) {
            getSectionIDs("repeating_Cons", function (idArray) {
                if (idArray.length == 0) {
                    if (isNullOrWhitespace(basicValues["MildConsequence"])
                        && isNullOrWhitespace(basicValues["MildInvoke"])
                        && isNullOrWhitespace(basicValues["ModerateConsequence"])
                        && isNullOrWhitespace(basicValues["ModerateInvoke"])
                        && isNullOrWhitespace(basicValues["SevereConsequence"])
                        && isNullOrWhitespace(basicValues["SevereInvoke"])) {
                            if (!isNullOrWhitespace(runFirstTimeSetup))
                                SetDefaultConsequences(default_consequences, show_conditions_flag);
                            return;
                        }
                    
                    importConsequence(2, basicValues["MildConsequence"], !isNullOrWhitespace(basicValues["MildInvoke"]));
                    importConsequence(4, basicValues["ModerateConsequence"], !isNullOrWhitespace(basicValues["ModerateInvoke"]));
                    importConsequence(6, basicValues["SevereConsequence"], !isNullOrWhitespace(basicValues["SevereInvoke"]));
                    return;
                }
            
                var attrs = [];
                for (var i = 0; i < idArray.length; i++) {
                    attrs.push("repeating_Cons_" + idArray[i] + "_conType");
                    attrs.push("repeating_Cons_" + idArray[i] + "_Consequence");
                    attrs.push("repeating_Cons_" + idArray[i] + "_Invoke");
                }
    
                getAttrs(attrs, function (repValues) {
                    importConsequence(2, basicValues["MildConsequence"], !isNullOrWhitespace(basicValues["MildInvoke"]));
                    importConsequence(4, basicValues["ModerateConsequence"], !isNullOrWhitespace(basicValues["ModerateInvoke"]));
                    importConsequence(6, basicValues["SevereConsequence"], !isNullOrWhitespace(basicValues["SevereInvoke"]));
    
                    for (var i = 0; i < idArray.length; i++) {
                        var worth = 0;
                        switch (repValues["repeating_Cons_" + idArray[i] + "_conType"]) {
                            case "Mild":
                                worth = 2;
                                break;
                            case "Moderate":
                                worth = 4;
                                break;
                            case "Severe":
                                worth = 6;
                                break;
                        }
                    
                        importConsequence(worth,
                            repValues["repeating_Cons_" + idArray[i] + "_Consequence"],
                            !isNullOrWhitespace(repValues["repeating_Cons_" + idArray[i] + "_Invoke"]));
                        
                        removeRepeatingRow("repeating_Cons_" + idArray[i]);
                    }
                });
            });    
        });
    };
    
    const importConsequence = (worth, aspect, addBonus) => {
        if (!isNaN(worth) && worth > 0) {
            var newRowAttrs = {};
            var newRowId = generateRowID();
            newRowAttrs["repeating_consequences_" + newRowId + "_worth"] = worth;
            newRowAttrs["repeating_consequences_" + newRowId + "_aspect"] = aspect;
            newRowAttrs["repeating_consequences_" + newRowId + "_worth_text"] = getConsequenceText(worth);
    
            setAttrs(newRowAttrs);
    
            if (addBonus)
                importSitAspect(aspect, 1);
        }
    };
    
    function SetDefaultConsequences (default_consequences, show_conditions_flag) {
        if (!isNullOrWhitespace(default_consequences)) {
            getSectionIDs("repeating_consequences", function (idArray) {
                if (idArray.length == 0) {
                    var consequences = default_consequences.split(",")
                    var newRowAttrs = {};
                    consequences.forEach(consequence => {
                        var elements = consequence.split("|");
                        var worth = Number(elements[0].trim());
                        if (!isNaN(worth) && worth > 0) {
                            var newRowId = generateRowID();
                            newRowAttrs["repeating_consequences_" + newRowId + "_worth"] = worth;
    
                            if (elements.length > 1)
                                newRowAttrs["repeating_consequences_" + newRowId + "_aspect"] = elements[1];
                            if (show_conditions_flag == "1")
                                newRowAttrs["repeating_consequences_" + newRowId + "_worth_text"] = getConditionsText(worth);
                            else
                                newRowAttrs["repeating_consequences_" + newRowId + "_worth_text"] = getConsequenceText(worth);
                        }
                    });
                    setAttrs(newRowAttrs);
                }
            });
        }
    };
    
    function getConsequenceText(worth) {
        switch (Number(worth)) {
            case 2:
                return "Mild";
            case 4:
                return "Moderate";
            case 6:
                return "Severe";
            case 8:
                return "Extreme";
            default:
                return "Custom";
        }
    };
    
</script>



